
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ciencia Ciudadana</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial; margin: 0; padding: 0; }
    #map { height: 500px; }
    .section { padding: 20px; }
    iframe { width: 100%; max-width: 800px; height: 450px; display: block; margin: auto; }
    form { margin-top: 20px; }
    input, button { display: block; margin: 10px 0; padding: 8px; width: 300px; }
    .flex-container { display: flex; gap: 20px; flex-wrap: wrap; }
    .video-section, .image-section { flex: 1; min-width: 300px; }
    .image-section img { width: 100%; max-width: 400px; display: block; margin-bottom: 10px; }
  </style>
</head>
<body>

  <div class="section">
    <h1>Mapas de cetaceos 
      Ayúdanos a construir el primer mapa ciudadano de cetáceos en la Patagonia </h1>
    <p>
      Este mapa interactivo muestra los puntos de avistamiento de cetáceos registrados en la Región de Magallanes.
      Cada marcador representa una observación con su respectiva especie, ubicación y fecha. 
      Cada avistamiento cuenta: comparte el tuyo y contribuye al conocimiento de nuestros océanos

    </p>
    <div id="map"></div>
  </div>

  <div class="section">
    <h2>Agregar nuevo avistamiento</h2>
    <p>
      Para ingresar un nuevo dato, simplemente haga clic en el mapa para obtener la ubicación, luego complete el formulario con:
      nombre del avistamiento (especie), coordenadas (ya están autocompletadas) y la fecha/hora del avistamiento. Luego presione "Enviar".
    </p>
    <form id="avistamientoForm">
      <input type="text" id="nombre" placeholder="Nombre del avistamiento" required />
      <input type="number" step="any" id="latitud" placeholder="Latitud" required />
      <input type="number" step="any" id="longitud" placeholder="Longitud" required />
      <input type="datetime-local" id="fecha_hora" required />
      <button type="submit">Enviar</button>
    </form>
    <p id="status"></p>
  </div>

 <div class="section flex-container" style="display: flex; flex-wrap: wrap; gap: 20px;">

  <!-- Video etiquetado con DeepLabCut -->
  <div class="video-section" style="flex: 1; min-width: 300px;">
    <h2>Video Etiquetado con DeepLabCut</h2>
    <p>
      Este video muestra un ejemplo de etiquetado automático realizado con la plataforma DeepLabCut. Se pueden observar 3 delfines etiquetados
      dentro de un grupo de 7. Puedes pausar el video o avanzar cuadro a cuadro para identificar comportamientos
      como cópulas o patrones de movimiento individuales.
    </p>
    <iframe src="https://drive.google.com/file/d/1X3GRKkGTFH878GbsoCmc8_OyqnlDqXDe/preview" allow="autoplay"></iframe>
  </div>

  <!-- Video georreferenciado -->
  <div class="video-section" style="flex: 1; min-width: 300px;">
    <h2>Video georreferenciado desde dron</h2>
    <p>
      Este video fue capturado por dron y contiene datos de GPS frame por frame. Está sincronizado con el video etiquetado para visualizar
      trayectorias reales de desplazamiento en el espacio de cada individuo observado.
    </p>
    <iframe src="https://drive.google.com/file/d/1Kvfe0lmvMZ2asCkzBC2zvLqxBy2iWl0e/preview" allow="autoplay"></iframe>
  </div>

  <!-- Gráfico posición Y -->
  <div class="image-section" style="flex: 1; min-width: 300px;">
    <img src="https://drive.google.com/uc?export=view&id=1Vglbg53X4dMkL-rxN7iYo_Owv0h_NLaH" alt="Gráfico Posición Y" style="width: 100%;" />
    <p><b>Gráfico de posición Y:</b> Muestra el movimiento vertical (eje Y en píxeles) de tres delfines a lo largo del tiempo. Representa ascensos y descensos en la escena.</p>
  </div>

  <!-- Gráfico posición X -->
  <div class="image-section" style="flex: 1; min-width: 300px;">
    <img src="https://drive.google.com/uc?export=view&id=1YZ78jAIBccmuoMoWY5Zd0yQVEPS_pDOf" alt="Gráfico Posición X" style="width: 100%;" />
    <p><b>Gráfico de posición X:</b> Representa el desplazamiento lateral (eje X) de los delfines frame por frame en el video. Es útil para observar movimientos horizontales y patrones de interacción.</p>
  </div>

  <!-- Tus tres imágenes adicionales -->
  <div class="image-section" style="flex: 1 1 100%;">
    <img src="imagen1.jpg" alt="Gráfico 1 - Distribución" style="width: 100%;" />
    <p><b>Gráfico 1:</b> Muestra la distribución espacial de los avistamientos a lo largo del Estrecho de Magallanes.</p>

    <img src="imagen2.jpg" alt="Gráfico 2 - Frecuencia de especies" style="width: 100%;" />
    <p><b>Gráfico 2:</b> Representa la frecuencia de avistamientos por especie, destacando al delfín austral como uno de los más observados.</p>

    <img src="imagen3.jpg" alt="Gráfico 3 - Horario de actividad" style="width: 100%;" />
    <p><b>Gráfico 3:</b> Análisis del horario de mayor actividad de los individuos registrados en la zona de estudio.</p>
  </div>

</div>

      rows.forEach(row => {
        const [nombre, lat, lon, fecha] = row.split(',');
        if (!isNaN(lat) && !isNaN(lon)) {
          L.circleMarker([parseFloat(lat), parseFloat(lon)], {
            radius: 6,
            color: "red",
            fillColor: "red",
            fillOpacity: 0.9
          }).addTo(map)
            .bindPopup(`<b>${nombre}</b><br>${fecha}`);
        }
      });
    }

    cargarPuntos();

    const form = document.getElementById('avistamientoForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        nombre: document.getElementById('nombre').value,
        latitud: document.getElementById('latitud').value,
        longitud: document.getElementById('longitud').value,
        fecha_hora: document.getElementById('fecha_hora').value
      };
      const status = document.getElementById('status');
      status.textContent = "Enviando datos...";

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbxU8ONChjOfqlqW1KcKvf0_BMU-8l5jKOCjZ7aQL_ypcjbzqBgUHm6rOmR9kcZGW2aIwg/exec", {
          method: "POST",
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.result === "success") {
          status.textContent = "Avistamiento enviado correctamente.";
          form.reset();
          map.eachLayer((layer) => {
            if (layer instanceof L.CircleMarker) map.removeLayer(layer);
          });
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(map);
          cargarPuntos();
        } else {
          status.textContent = "Hubo un error al enviar.";
        }
      } catch (err) {
        status.textContent = "Error de conexión.";
      }
    });
  </script>

</body>
</html>
